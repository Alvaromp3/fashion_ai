# Env Vault — one place for all keys

All env (backend + frontend prod + frontend local) lives in [dotenv-vault](https://dotenv.org/docs/dotenv-vault). You edit local files, then **push** to save. You **pull** to load. Use **production** for deploy (Render, Cloudflare). Use **development** for local dev.

---

## Commands (run from repo root)

| What you want | Command |
|---------------|--------|
| **Load production keys** (Render, Cloudflare, deploy) | `npm run env:vault-pull` |
| **Load development keys** (local backend + frontend) | `npm run env:vault-pull:dev` |
| **Save current keys as production** | `npm run env:vault-push` |
| **Save current keys as development** | `npm run env:vault-push:dev` |

After pull, you get: `backend/.env`, `frontend/.env`, `frontend/.env.local`.  
Before push, set those three files to the values you want, then run the push command.

---

## When to use which

- **Production** — Values for Render (backend), Cloudflare Pages (frontend build), and prod URLs. Use `env:vault-pull` before syncing to Render (`npm run render:env`) or Cloudflare (`npm run cloudflare:pages-env`), and use `env:vault-push` after you change prod keys.
- **Development** — Values for local runs (e.g. local MongoDB, localhost callbacks, empty `VITE_API_BASE_URL` for proxy). Use `env:vault-pull:dev` when developing locally; use `env:vault-push:dev` after you change dev-only keys.

---

## First-time / new machine

1. Get the vault key (from `.env.vault` → `DOTENV_VAULT="vlt_..."` or from whoever owns the vault).
2. From repo root: `npx dotenv-vault@latest new vlt_YOUR_KEY_HERE`
3. Load keys: `npm run env:vault-pull` (prod) or `npm run env:vault-pull:dev` (dev).

Only vault owners can push; everyone else can pull with the key.

---

## Sync to hosts

| Goal | Steps |
|------|--------|
| Vault → Render | `npm run env:vault-pull` then `npm run render:env` (then deploy backend). |
| Vault → Cloudflare Pages | `npm run env:vault-pull` then `npm run cloudflare:pages-env` then redeploy frontend. |
| One command: vault → Render | `npm run env:sync-render` (pull production + push to Render). |

---

## Which file is used when

| Context | Backend | Frontend |
|--------|---------|----------|
| **Local dev** (`npm run start`, `npm run dev`) | `backend/.env` only | `frontend/.env` + `frontend/.env.local` (`.env.local` overrides) |
| **Production build / deploy** | Render uses vars you pushed from `backend/.env` via `render:env` | Build uses `frontend/.env`; Cloudflare Pages gets VITE_* from `frontend/.env` via `cloudflare:pages-env` |

So: **local** uses `backend/.env` and frontend’s `.env` + `.env.local`. **Prod** uses the same files after you run `env:vault-pull` (so they contain prod values), then you run `render:env` and `cloudflare:pages-env` to push those values to Render and Cloudflare.

---

## Files

- **backend/.env** — Backend only (Node, Render).
- **frontend/.env** — Frontend production (used by Cloudflare build and by `cloudflare:pages-env`).
- **frontend/.env.local** — Frontend local overrides (Vite uses when you run `npm run dev`).
- **Root .env** — Generated by combine; used only for vault push/pull. Do not edit; it’s in `.gitignore`.

[Dotenv Vault docs](https://dotenv.org/docs/dotenv-vault)
